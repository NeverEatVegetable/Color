{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/shared/tsgfServer/redisHelper.ts"],"names":["RedisClient","MemRedisClient","initRedisClient","cfg","configKey","allRedisCfg","set","existsClient","allRedisClients","get","disconnect","useMemRedis","createClient","getRedisClient","reuseClient","client","Error","commandOptions","v4","logger","delay","constructor","config","configUrl","reconnectHd","reconnectWaiting","showConnectError","id","url","ssl","username","password","host","port","database","rc","isFirst","connTask","Promise","resolve","on","error","tryReconnect","connect","retryEx","ex","clearTimeout","setTimeout","reconnect","undefined","isOpen","log","e","delete","keys","del","setString","key","val","exTimeSec","opt","EX","getString","setObject","valJson","JSON","stringify","getObject","json","parse","setHashObject","field","valueObject","setHashString","valueString","hSet","getHashString","hGet","getHashObject","getHashObjects","kv","hGetAll","ret","getHashValues","removeHashValue","hDel","rPushObject","redisKey","item","rPush","lPopObject","lPop","blPopObject","timeoutSec","blPop","isolated","element","incr","decr","incrBy","increment","decrBy","publishObject","publish","subscribeObject","listen","subscribe","unsubscribe","memCacheKV","memCacheHSet","Map","obj","list","memCacheList","push","shift","time","allTime","nStr","n","parseInt","ls","memCachePubSub","fn","memCacheInc"],"mappings":"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","sourcesContent":["\nimport { commandOptions, createClient, RedisClientType, RedisFunctions, RedisModules, RedisScripts } from 'redis';\nimport { v4 } from \"uuid\";\nimport { RedisConfig } from '../../ServerConfig';\nimport { logger } from \"../tsgf/logger\";\nimport { delay } from \"../tsgf/Utils\";\n\n/**\n * redis客户端接口\n */\nexport interface IRedisClient {\n    disconnect(): Promise<void>;\n    /**\n     * 删除键\n     *\n     * @public\n     * @param keys\n     * @returns\n     */\n    delete(...keys: string[]): Promise<void>;\n    /**\n     * 设置键值对,值是字符串\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    setString(key: string, val: string, exTimeSec: number): Promise<void>;\n    /**\n     * 获取 @see setString 设置的值\n     * @param key \n     * @returns \n     */\n    getString(key: string): Promise<string | null>;\n    /**\n     * 设置键值对,值类型是对象\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    setObject(key: string, val: any, exTimeSec: number): Promise<void>;\n    /**\n     * 获取 @see setObject 设置的值\n     * @param key \n     * @returns \n     */\n    getObject<T>(key: string): Promise<T | null>;\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    setHashObject(key: string, field: string, valueObject: any): Promise<void>;\n    /**\n     * 设置hash表的字段为字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueString 字符串类型\n     * @returns\n     */\n    setHashString(key: string, field: string, valueString: string): Promise<void>;\n    /**\n     * 获取hash表的字段的字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    getHashString(key: string, field: string): Promise<string | null | undefined>;\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    getHashObject<T extends object>(key: string, field: string): Promise<T | null>;\n    /**\n     * 获取哈希表里的所有键值对，字段值为对象类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    getHashObjects<ValueType>(key: string): Promise<{ [key: string]: ValueType }>;\n    /**\n     * 获取哈希表里的所有键值对，字段值为字符串类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    getHashValues(key: string): Promise<{ [key: string]: string }>;\n    /**\n     * 删除hash表的字段\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    removeHashValue(key: string, field: string): Promise<void>;\n    /**\n     * 将一个元素推入列表的最后\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    rPushObject<T extends object>(redisKey: string, item: T): Promise<void>;\n    /**\n     * 读取并移除列表第一个元素，并json解析为对象，如果列表为空这个返回null\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @returns\n     */\n    lPopObject<T extends object>(redisKey: string): Promise<T | null>;\n    /**\n     * 阻塞的方式读取并移除列表第一个元素，并解析为对象，如果列表为空则会一直阻塞\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param timeoutSec 阻塞超时秒数，传0表示不超时，没数据则一直阻塞下去\n     * @returns\n     */\n    blPopObject<T extends object>(redisKey: string, timeoutSec: number): Promise<T | null>;/**\n     * 递增1并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    incr(redisKey: string): Promise<number>;\n    /**\n     * 递减1并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    decr(redisKey: string): Promise<number>;\n    /**\n     * 递增指定数值并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    incrBy(redisKey: string, increment: number): Promise<number>;\n    /**\n     * 递减指定数值并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    decrBy(redisKey: string, increment: number): Promise<number>;\n    /**\n     * 【发布、订阅】发布一个对象到key中\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    publishObject<T extends object>(redisKey: string, item: T): Promise<void>;\n    /**\n     * 【发布、订阅】订阅一个key中的消息，注意，本操作需要一个独立的连接！（可以使用getRedisClient(false)来创建一个全新的连接）\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    subscribeObject<T extends object>(redisKey: string, listen: (item: T) => void): Promise<void>;\n    /**\n     * 【发布、订阅】取消订阅一个key中的消息，注意，本操作的连接需要和订阅是同一个！\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    unsubscribe(redisKey: string): Promise<void>;\n}\n\n/**获取redis客户端实例的方法定义*/\nexport type GetRedisClient = () => Promise<IRedisClient>;\n\n/**redis客户端封装 */\nexport class RedisClient implements IRedisClient {\n    private config?: RedisConfig;\n    private configUrl: string;\n    private client?: RedisClientType<RedisModules, RedisFunctions, RedisScripts>;\n    private reconnectHd: any;\n    private reconnectWaiting: boolean = false;\n    /**是否已经显示过连接错误了*/\n    private showConnectError: boolean = false;\n    private id: string;\n    /**\n     * 初始化\n     * @param cfg 配置对象\n     */\n    private constructor(cfg: RedisConfig) {\n        this.id = v4();\n        this.config = cfg;\n        //redis[s]://[[username][:password]@][host][:port][/db-number]:\n        let url = \"redis\" + (this.config.ssl ? 's' : '') + \"://\";\n        if (this.config.username) {\n            url += this.config.username;\n            if (this.config.password) {\n                url += \":\" + this.config.password;\n            }\n            url += \"@\";\n        }\n        url += this.config.host + ':' + this.config.port\n            + '/' + this.config.database;\n        this.configUrl = url;\n\n        this.client = createClient({\n            url: this.configUrl\n        });\n    }\n\n    /**\n     * 创建连接好的客户端,建议全局静态一个\n     * @param cfg \n     * @returns \n     */\n    public static async createClient(cfg: RedisConfig): Promise<IRedisClient> {\n        let rc = new RedisClient(cfg);\n        let isFirst = true;\n        //redis的connect()方法实现的很坑, 如果没连接成功,触发完on('error')事件后,不会resolve或者reject继续,并且还会走自动重连\n        //所以这里统一封装一个连接的异步任务,兼容connect的处理流程,即使连不上,也能正常走后续\n        let connTask = new Promise<void>(async (resolve) => {\n            //实现额外的网络错误重连\n            rc.client?.on('error', async (error: any) => {\n                //暂时不启用自定义重连机制,暂时先相信redis客户端自己的重连机制\n                //IRedisClient.tryReconnect(rc, null);\n                //logger.log(`redisClient错误[${rc.id}]!`, error);\n                if (!rc.showConnectError) {\n                    rc.showConnectError = true;\n                    logger.error(`redisClient连接错误[${rc.id}]!(自动重试中...)`, error);\n                }\n                if (isFirst) {\n                    //还没连上就出错了,那就补充connect那边的异步回调\n                    isFirst = false;\n                    return resolve();\n                }\n            });\n            rc.client?.on('reconnecting', async () => {\n                //logger.log(`redisClient正在重连[${rc.id}]!`);\n            });\n            rc.client?.on('end', async (error: any) => {\n                isFirst = false;\n                //断开事件触发后尝试重连(如果是手动调用断开的会跳过)\n                RedisClient.tryReconnect(rc, null);\n            });\n            rc.client?.on('ready', async (error: any) => {\n                isFirst = false;\n                rc.showConnectError = false;\n                //logger.log(`redisClient连接成功[${rc.id}]!`);\n            });\n            await rc.client?.connect();\n            //到这里了,说明连接成功了!返回\n            return resolve();\n        });\n        await connTask;\n        return rc;\n    }\n\n    /**暂时不需要自己的重连机制*/\n    private static async tryReconnect(rc?: RedisClient, retryEx: any | null = null) {\n        if (!rc) return;\n        if (!rc.reconnectWaiting) {\n            //因为error事件会多次重复触发, 所以用个标志只处理一次\n            try {\n                await rc.client?.disconnect();\n            } catch (ex) {\n                //logger.error(`redisClient断开[${rc.id}]产生错误`, ex);\n            }\n            rc.reconnectWaiting = true;\n            if (retryEx) {\n                logger.error(`redisClient重连失败[${rc.id}], 2秒后再次重连!`, retryEx);\n            } else {\n                logger.error(`redisClient断开[${rc.id}], 2秒后重连尝试!`);\n            }\n            clearTimeout(rc.reconnectHd);\n            rc.reconnectHd = setTimeout((rc?: RedisClient) => {\n                if (rc) {\n                    rc.reconnectWaiting = false;\n                    RedisClient.reconnect(rc)\n                    rc = undefined;\n                }\n            }, 2000, rc);\n        }\n        rc = undefined;\n    }\n    /**暂时不需要自己的重连机制*/\n    private static async reconnect(rc?: RedisClient) {\n        if (!rc) return;\n        clearTimeout(rc.reconnectHd);\n        if (rc.client?.isOpen === true) {\n            //开始重连时,状态就是连上的,则直接成功\n            logger.log(`redisClient重连成功[${rc.id}]! [01]`);\n        } else {\n            try {\n                //尝试连接\n                await rc.client?.connect();\n                //没报错则成功\n                logger.log(`redisClient重连成功[${rc.id}]! [02]`);\n            } catch (ex) {\n                if (rc.client?.isOpen) {\n                    //报错后发现是连接状态的,则视为成功\n                    logger.log(`redisClient重连成功[${rc.id}]! [03]`);\n                    return;\n                }\n                //其他错误,则再次重试\n                RedisClient.tryReconnect(rc, ex);\n            }\n        }\n        rc = undefined;\n    }\n    public async disconnect(): Promise<void> {\n        clearTimeout(this.reconnectHd);\n        try {\n            await this.client?.disconnect();\n        } catch (e) { }\n        this.client = undefined;\n        this.config = undefined;\n    }\n\n\n    /**\n     * 删除键\n     *\n     * @public\n     * @param keys\n     * @returns\n     */\n    public async delete(...keys: string[]): Promise<void> {\n        await this.client?.del(keys);\n    }\n    /**\n     * 设置键值对,值是字符串\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    public async setString(key: string, val: string, exTimeSec: number = 0): Promise<void> {\n        let opt: any = {};\n        if (exTimeSec) {\n            opt.EX = exTimeSec;\n        }\n        await this.client?.set(key, val, opt);\n    }\n    /**\n     * 获取 @see setString 设置的值\n     * @param key \n     * @returns \n     */\n    public async getString(key: string): Promise<string | null> {\n        return await this.client?.get(key) ?? null;\n    }\n\n    /**\n     * 设置键值对,值类型是对象\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    public async setObject(key: string, val: any, exTimeSec: number = 0): Promise<void> {\n        let valJson: any = null;\n        if (val) {\n            valJson = JSON.stringify(val);\n        }\n        await this.setString(key, valJson, exTimeSec);\n    }\n    /**\n     * 获取 @see setObject 设置的值\n     * @param key \n     * @returns \n     */\n    public async getObject<T>(key: string): Promise<T | null> {\n        let json = await this.getString(key);\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error('getObject(\"' + key + '\")json解析失败:', json);\n            return null;\n        }\n    }\n\n\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    public async setHashObject(key: string, field: string, valueObject: any): Promise<void> {\n        let valJson: any = null;\n        if (valueObject) {\n            valJson = JSON.stringify(valueObject);\n        }\n        await this.setHashString(key, field, valJson);\n    }\n    /**\n     * 设置hash表的字段为字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueString 字符串类型\n     * @returns\n     */\n    public async setHashString(key: string, field: string, valueString: string): Promise<void> {\n        await this.client?.hSet(key, field, valueString);\n    }\n    /**\n     * 获取hash表的字段的字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    public async getHashString(key: string, field: string): Promise<string | null | undefined> {\n        return await this.client?.hGet(key, field);\n    }\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    public async getHashObject<T extends object>(key: string, field: string): Promise<T | null> {\n        let json: any = await this.getHashString(key, field);\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error(`getHashObject(${key}, ${field})json解析失败:`, json);\n            return null;\n        }\n\n    }\n\n\n    /**\n     * 获取哈希表里的所有键值对，字段值为对象类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    public async getHashObjects<ValueType>(key: string): Promise<{ [key: string]: ValueType }> {\n        let kv = await this.client?.hGetAll(key);\n        let ret: { [key: string]: ValueType } = {};\n        if (kv) {\n            for (let key in kv) {\n                let json = kv[key];\n                ret[key] = JSON.parse(json);\n            }\n        }\n        return ret;\n    }\n    /**\n     * 获取哈希表里的所有键值对，字段值为字符串类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    public async getHashValues(key: string): Promise<{ [key: string]: string }> {\n        return await this.client?.hGetAll(key) ?? {};\n    }\n\n    /**\n     * 删除hash表的字段\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    public async removeHashValue(key: string, field: string): Promise<void> {\n        await this.client?.hDel(key, field);\n    }\n\n\n    /**\n     * 将一个元素推入列表的最后\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async rPushObject<T extends object>(redisKey: string, item: T): Promise<void> {\n        let valJson: any = null;\n        if (item) {\n            valJson = JSON.stringify(item);\n        }\n        await this.client?.rPush(redisKey, valJson);\n    }\n\n\n    /**\n     * 读取并移除列表第一个元素，并json解析为对象，如果列表为空这个返回null\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @returns\n     */\n    public async lPopObject<T extends object>(redisKey: string): Promise<T | null> {\n        let json = await this.client?.lPop(redisKey);\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error('IRedisClient.lPopObject(\"' + redisKey + '\")json解析失败:', json);\n            return null;\n        }\n    }\n\n\n    /**\n     * 阻塞的方式读取并移除列表第一个元素，并解析为对象，如果列表为空则会一直阻塞\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param timeoutSec 阻塞超时秒数，传0表示不超时，没数据则一直阻塞下去\n     * @returns\n     */\n    public async blPopObject<T extends object>(redisKey: string, timeoutSec: number): Promise<T | null> {\n        let ret = await this.client?.blPop(commandOptions({ isolated: true }), redisKey, timeoutSec);\n        if (!ret || !ret.element) return null;\n        try {\n            return JSON.parse(ret.element) as T;\n        } catch (ex) {\n            logger.error('IRedisClient.blPopObject(\"' + redisKey + '\")json解析失败:', ret.element);\n            return null;\n        }\n    }\n\n\n    /**\n     * 递增1并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    public async incr(redisKey: string): Promise<number> {\n        return await this.client?.incr(redisKey) ?? 0;\n    }\n    /**\n     * 递减1并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    public async decr(redisKey: string): Promise<number> {\n        return await this.client?.decr(redisKey) ?? 0;\n    }\n\n    /**\n     * 递增指定数值并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    public async incrBy(redisKey: string, increment: number): Promise<number> {\n        return await this.client?.incrBy(redisKey, increment) ?? 0;\n    }\n    /**\n     * 递减指定数值并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    public async decrBy(redisKey: string, increment: number): Promise<number> {\n        return await this.client?.decrBy(redisKey, increment) ?? 0;\n    }\n\n\n\n    /**\n     * 【发布、订阅】发布一个对象到key中\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async publishObject<T extends object>(redisKey: string, item: T): Promise<void> {\n        let valJson: any = null;\n        if (item) {\n            valJson = JSON.stringify(item);\n        }\n        await this.client?.publish(redisKey, valJson);\n    }\n\n    /**\n     * 【发布、订阅】订阅一个key中的消息，注意，本操作需要一个独立的连接！（可以使用getRedisClient(false)来创建一个全新的连接）\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async subscribeObject<T extends object>(redisKey: string, listen: (item: T) => void): Promise<void> {\n        await this.client?.subscribe(redisKey, (json: string) => {\n            if (!json) return;\n            let item: T;\n            try {\n                item = JSON.parse(json) as T;\n            } catch (ex) {\n                logger.error('IRedisClient.subscribeObject(\"' + redisKey + '\")json解析失败:', ex, \"json:\", json);\n                return;\n            }\n            listen(item);\n        });\n    }\n    /**\n     * 【发布、订阅】取消订阅一个key中的消息，注意，本操作的连接需要和订阅是同一个！\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async unsubscribe(redisKey: string): Promise<void> {\n        await this.client?.unsubscribe(redisKey);\n    }\n}\n/**单机内存版的实现，用在简易的all-in-one场景，减少redis的依赖！*/\nexport class MemRedisClient implements IRedisClient {\n\n    private static memCacheKV: Map<string, string> = new Map<string, string>();\n    private static memCacheHSet: Map<string, Map<string, string>> = new Map<string, Map<string, string>>();\n    private static memCacheList: Map<string, string[]> = new Map<string, string[]>();\n    private static memCacheInc: Map<string, number> = new Map<string, number>();\n    private static memCachePubSub: Map<string, ((item: string) => void)[]> = new Map<string, ((item: string) => void)[]>();\n\n    public async disconnect(): Promise<void> {\n    }\n\n\n    /**\n     * 删除键\n     *\n     * @public\n     * @param key\n     * @returns\n     */\n    public async delete(...keys: string[]): Promise<void> {\n        for (let key of keys) {\n            MemRedisClient.memCacheKV.delete(key);\n        }\n    }\n    /**\n     * 设置键值对,值是字符串\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    public async setString(key: string, val: string, exTimeSec: number = 0): Promise<void> {\n        let opt: any = {};\n        if (exTimeSec) {\n            opt.EX = exTimeSec;\n        }\n        MemRedisClient.memCacheKV.set(key, val);\n    }\n    /**\n     * 获取 @see setString 设置的值\n     * @param key \n     * @returns \n     */\n    public async getString(key: string): Promise<string | null> {\n        return MemRedisClient.memCacheKV.get(key) ?? null;\n    }\n\n    /**\n     * 设置键值对,值类型是对象\n     * @param key \n     * @param val \n     * @param exTimeSec 在几秒后过期,0表示永不过期\n     */\n    public async setObject(key: string, val: any, exTimeSec: number = 0): Promise<void> {\n        let valJson: any = null;\n        if (val) {\n            valJson = JSON.stringify(val);\n        }\n        await this.setString(key, valJson, exTimeSec);\n    }\n    /**\n     * 获取 @see setObject 设置的值\n     * @param key \n     * @returns \n     */\n    public async getObject<T>(key: string): Promise<T | null> {\n        let json = await this.getString(key);\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error('getObject(\"' + key + '\")json解析失败:', json);\n            return null;\n        }\n    }\n\n\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    public async setHashObject(key: string, field: string, valueObject: any): Promise<void> {\n        let valJson: any = null;\n        if (valueObject) {\n            valJson = JSON.stringify(valueObject);\n        }\n        await this.setHashString(key, field, valJson);\n    }\n    /**\n     * 设置hash表的字段为字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueString 字符串类型\n     * @returns\n     */\n    public async setHashString(key: string, field: string, valueString: string): Promise<void> {\n        let set = MemRedisClient.memCacheHSet.get(key);\n        if (!set) {\n            set = new Map<string, string>();\n            MemRedisClient.memCacheHSet.set(key, set);\n        }\n        set.set(field, valueString);\n    }\n    /**\n     * 获取hash表的字段的字符串值\n     *\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    public async getHashString(key: string, field: string): Promise<string | null | undefined> {\n        let set = MemRedisClient.memCacheHSet.get(key);\n        if (!set) {\n            return null;\n        }\n        return set.get(field);\n    }\n    /**\n     * 设置hash表的字段为对象值（会被序列化为json字符串进行存储）\n     *\n     * @public\n     * @param key\n     * @param field\n     * @param valueObject 对象类型\n     * @returns\n     */\n    public async getHashObject<T extends object>(key: string, field: string): Promise<T | null> {\n        let json: any = await this.getHashString(key, field);\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error(`getHashObject(${key}, ${field})json解析失败:`, json);\n            return null;\n        }\n\n    }\n\n\n    /**\n     * 获取哈希表里的所有键值对，字段值为对象类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    public async getHashObjects<ValueType>(key: string): Promise<{ [key: string]: ValueType }> {\n        let set = MemRedisClient.memCacheHSet.get(key);\n        if (!set) {\n            return {};\n        }\n        let ret: { [key: string]: ValueType } = {};\n        for (let kv of set) {\n            ret[kv[0]] = JSON.parse(kv[1]);;\n        }\n        return ret;\n    }\n    /**\n     * 获取哈希表里的所有键值对，字段值为字符串类型\n     *\n     * @public\n     * @typeParam ValueType\n     * @param key\n     * @returns\n     */\n    public async getHashValues(key: string): Promise<{ [key: string]: string }> {\n        let set = MemRedisClient.memCacheHSet.get(key);\n        if (!set) {\n            return {};\n        }\n        let obj: { [key: string]: string } = {};\n        for (let kv of set) {\n            obj[kv[0]] = kv[1];\n        }\n        return obj;\n    }\n\n    /**\n     * 删除hash表的字段\n     * @public\n     * @param key\n     * @param field\n     * @returns\n     */\n    public async removeHashValue(key: string, field: string): Promise<void> {\n        let set = MemRedisClient.memCacheHSet.get(key);\n        if (!set) {\n            return;\n        }\n        set.delete(field);\n    }\n\n\n\n\n    /**\n     * 将一个元素推入列表的最后\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async rPushObject<T extends object>(redisKey: string, item: T): Promise<void> {\n        let valJson: any = null;\n        if (item) {\n            valJson = JSON.stringify(item);\n        }\n        let list = MemRedisClient.memCacheList.get(redisKey);\n        if (!list) {\n            list = [];\n            MemRedisClient.memCacheList.set(redisKey, list);\n        }\n        list.push(valJson);\n    }\n\n\n    /**\n     * 读取并移除列表第一个元素，并json解析为对象，如果列表为空这个返回null\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @returns\n     */\n    public async lPopObject<T extends object>(redisKey: string): Promise<T | null> {\n        let list = MemRedisClient.memCacheList.get(redisKey);\n        if (!list) {\n            list = [];\n            MemRedisClient.memCacheList.set(redisKey, list);\n        }\n        let json = list.shift();\n        if (!json) return null;\n        try {\n            return JSON.parse(json) as T;\n        } catch (ex) {\n            logger.error('IRedisClient.lPopObject(\"' + redisKey + '\")json解析失败:', json);\n            return null;\n        }\n    }\n\n\n    /**\n     * 阻塞的方式读取并移除列表第一个元素，并解析为对象，如果列表为空则会一直阻塞\n     *\n     * @public\n     * @typeParam T extends object 必须是对象类型\n     * @param redisKey\n     * @param timeoutSec 阻塞超时秒数，传0表示不超时，没数据则一直阻塞下去\n     * @returns\n     */\n    public async blPopObject<T extends object>(redisKey: string, timeoutSec: number): Promise<T | null> {\n        return await new Promise<T | null>(async resolve => {\n            let time = 0, allTime = timeoutSec * 1000;\n            while (timeoutSec === 0 || time < allTime) {\n                let val = await this.lPopObject<T>(redisKey);\n                if (val) return resolve(val);\n                await delay(300);\n                time += 300;\n            }\n            resolve(null);\n        });\n    }\n\n\n    /**\n     * 递增1并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    public async incr(redisKey: string): Promise<number> {\n        let nStr = MemRedisClient.memCacheKV.get(redisKey);\n        if (typeof (nStr) === 'undefined') {\n            nStr = '0';\n        }\n        let n = parseInt(nStr);\n        n++;\n        MemRedisClient.memCacheKV.set(redisKey, n + '');\n        return n;\n    }\n    /**\n     * 递减1并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @returns\n     */\n    public async decr(redisKey: string): Promise<number> {\n        let nStr = MemRedisClient.memCacheKV.get(redisKey);\n        if (typeof (nStr) === 'undefined') {\n            nStr = '0';\n        }\n        let n = parseInt(nStr);\n        n--;\n        MemRedisClient.memCacheKV.set(redisKey, n + '');\n        return n;\n    }\n\n    /**\n     * 递增指定数值并返回递增后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    public async incrBy(redisKey: string, increment: number): Promise<number> {\n        let nStr = MemRedisClient.memCacheKV.get(redisKey);\n        if (typeof (nStr) === 'undefined') {\n            nStr = '0';\n        }\n        let n = parseInt(nStr);\n        n += increment;\n        MemRedisClient.memCacheKV.set(redisKey, n + '');\n        return n;\n    }\n    /**\n     * 递减指定数值并返回递减后的数值，如果没有则会当作0来执行\n     *\n     * @public\n     * @param redisKey\n     * @param increment 整数\n     * @returns\n     */\n    public async decrBy(redisKey: string, increment: number): Promise<number> {\n        let nStr = MemRedisClient.memCacheKV.get(redisKey);\n        if (typeof (nStr) === 'undefined') {\n            nStr = '0';\n        }\n        let n = parseInt(nStr);\n        n -= increment;\n        MemRedisClient.memCacheKV.set(redisKey, n + '');\n        return n;\n    }\n\n\n    /**\n     * 【发布、订阅】发布一个对象到key中\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async publishObject<T extends object>(redisKey: string, item: T): Promise<void> {\n        let valJson: any = null;\n        if (item) {\n            valJson = JSON.stringify(item);\n        }\n        let ls = MemRedisClient.memCachePubSub.get(redisKey);\n        if (ls) {\n            for (let fn of ls) {\n                fn(valJson);\n            }\n        }\n    }\n\n    /**\n     * 【发布、订阅】订阅一个key中的消息，注意，本操作需要一个独立的连接！（可以使用getRedisClient(false)来创建一个全新的连接）\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param listen\n     * @returns\n     */\n    public async subscribeObject<T extends object>(redisKey: string, listen: (item: T) => void): Promise<void> {\n        let ls = MemRedisClient.memCachePubSub.get(redisKey);\n        if (!ls) {\n            ls = [];\n            MemRedisClient.memCachePubSub.set(redisKey, ls);\n        }\n        ls.push(json => {\n            if (!json) return;\n            let item: T;\n            try {\n                item = JSON.parse(json) as T;\n            } catch (ex) {\n                logger.error('IRedisClient.subscribeObject(\"' + redisKey + '\")json解析失败:', ex, \"json:\", json);\n                return;\n            }\n            listen(item);\n        });\n    }\n    /**\n     * 【发布、订阅】取消订阅一个key中的消息，注意，本操作的连接需要和订阅是同一个！\n     *\n     * @public\n     * @typeParam T extends object 需要是一个对象\n     * @param redisKey\n     * @param item\n     * @returns\n     */\n    public async unsubscribe(redisKey: string): Promise<void> {\n        MemRedisClient.memCachePubSub.delete(redisKey);\n    }\n}\n\nconst allRedisClients: Map<string, IRedisClient> = new Map<string, IRedisClient>();\nconst allRedisCfg: Map<string, RedisConfig> = new Map<string, RedisConfig>();\n\n/**\n * 初始化指定配置的redis客户端配置,如果已经存在会断开之前的连接(相当于重置)\n * @param cfg \n * @param configKey 根据这配置标识区分客户端\n */\nexport async function initRedisClient(cfg: RedisConfig, configKey: string = \"default\"): Promise<void> {\n    allRedisCfg.set(configKey, cfg);\n    let existsClient = allRedisClients.get(configKey);\n    if (existsClient) await existsClient.disconnect();\n    if (cfg.useMemRedis) {\n        existsClient = new MemRedisClient();\n    } else {\n        existsClient = await RedisClient.createClient(cfg);\n    }\n    allRedisClients.set(configKey, existsClient);\n}\n/**\n * 获取redis客户端(需要先调用初始化), 全局共享同配置的客户端实例\n * @param reuseClient 是否复用连接,否的只是单纯的创建一个全新的连接并返回\n * @param configKey 如果没传使用默认值\n * @returns \n */\nexport async function getRedisClient(reuseClient: boolean = true, configKey: string = \"default\"): Promise<IRedisClient> {\n    if (reuseClient) {\n        let client = allRedisClients.get(configKey);\n        if (client) return client;\n        let cfg = allRedisCfg.get(configKey);\n        if (!cfg) {\n            throw new Error(`${configKey}标识未初始化配置!`);\n        }\n        if (cfg.useMemRedis) {\n            client = new MemRedisClient();\n        } else {\n            client = await RedisClient.createClient(cfg);\n        }\n        allRedisClients.set(configKey, client);\n        return client;\n    } else {\n        let cfg = allRedisCfg.get(configKey);\n        if (!cfg) {\n            throw new Error(`${configKey}标识未初始化配置!`);\n        }\n        if (cfg.useMemRedis) {\n            return new MemRedisClient();\n        } else {\n            return await RedisClient.createClient(cfg);\n        }\n    }\n}"]}