{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/tsgf-sdk/src/hallClient/HallClient.ts"],"names":["HallClient","hallServiceProto","serviceProto","Result","AHttpClient","logger","constructor","serverUrl","timeout","server","json","client","flows","preCallApiFlow","push","v","recoverPlayerRoom","playerId","playerToken","updateShowName","ret","callApi","isSucc","buildErr","err","message","code","buildSucc","res","roomOnlineInfo","createRoom","createPa","para","getRoomOnlineInfo","roomId","getOrCreateRoom","requestMatch","matchParams","matchReqId","queryMatch","hasResult","errMsg","errCode","matchResult","cancelMatch","filterRooms","filter","skip","limit","ownDismissRoom"],"mappings":"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","sourcesContent":["\nimport { serviceProto as hallServiceProto, ServiceType } from \"./protocols/serviceProto\";\nimport { IResult, Result } from \"../tsgf/Result\";\nimport { AHttpClient } from \"../tsgf/AClient\";\nimport { IMatchParamsFromPlayer, IMatchResult } from \"../tsgf/match/Models\";\nimport { ReqCreateRoom } from \"./protocols/PtlCreateRoom\";\nimport { ICreateRoomPara, IGetOrCreateRoomPara, IGetOrCreateRoomRsp, IRoomOnlineInfo, IRoomsFilterPara, IRoomsFilterRes } from \"../tsgf/room/IRoomInfo\";\nimport { logger } from \"../tsgf/logger\";\n\nexport type hallServiceType = ServiceType;\n\n/**\n * 基础的大厅服务器api的客户端封装\n */\nexport class HallClient extends AHttpClient<hallServiceType>{\n\n    constructor(serverUrl: string, timeout?: number) {\n        super(hallServiceProto, {\n            server: serverUrl,\n            json: true,\n            logger: logger,\n            timeout,\n        });\n\n        this.client.flows.preCallApiFlow.push((v) => {\n            return v;\n        });\n    }\n\n    /**\n     * 认证并返回尝试恢复玩家房间信息，如果玩家还被保留在房间中,则返回之前所在房间id,需要再调用GameClient的重连方法\n     * @param playerId \n     * @param playerToken \n     * @param updateShowName 可更新玩家显示名 \n     * @returns player room \n     */\n    public async recoverPlayerRoom(playerId: string, playerToken: string, updateShowName?: string): Promise<IResult<IRoomOnlineInfo | null>> {\n        const ret = await this.client.callApi(\"RecoverPlayerRoom\", {\n            playerId: playerId,\n            playerToken: playerToken,\n            updateShowName: updateShowName,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n\n    /**\n     * 创建房间，并获得分配的游戏服务器，得到后用游戏服务器客户端进行连接\n     * @param playerToken \n     * @param createPa \n     * @returns 返回是否有错误消息,null表示成功\n     */\n    public async createRoom(playerToken: string, createPa: ICreateRoomPara): Promise<IResult<IRoomOnlineInfo>> {\n        let para: ReqCreateRoom = createPa as ReqCreateRoom;\n        para.playerToken = playerToken;\n        const ret = await this.client.callApi(\"CreateRoom\", para);\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n    /**\n     * 获取房间的在线信息，然后需要用游戏服务器客户端连接再加入房间\n     * @param playerToken \n     * @param createPa \n     * @returns 返回是否有错误消息,null表示成功\n     */\n    public async getRoomOnlineInfo(playerToken: string, roomId: string): Promise<IResult<IRoomOnlineInfo>> {\n        const ret = await this.client.callApi(\"GetRoomOnlineInfo\", {\n            playerToken: playerToken,\n            roomId: roomId\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n    /**\n     * 获取或创建符合条件的房间\n     * @param playerToken \n     * @param createPa \n     * @returns 返回是否有错误消息,null表示成功\n     */\n    public async getOrCreateRoom(playerToken: string, para: IGetOrCreateRoomPara): Promise<IResult<IGetOrCreateRoomRsp>> {\n        const ret = await this.client.callApi(\"GetOrCreateRoom\", {\n            ...para,\n            playerToken,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res);\n    }\n\n    /**\n     * 请求匹配，返回匹配请求ID，用queryMatch查询匹配结果，建议2秒一次查询\n     * @param playerToken \n     * @param matchParams \n     * @returns 返回是否有错误消息,null表示成功\n     */\n    public async requestMatch(playerToken: string, matchParams: IMatchParamsFromPlayer): Promise<IResult<string>> {\n        const ret = await this.client.callApi(\"RequestMatch\", {\n            playerToken: playerToken,\n            matchParams: matchParams,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.matchReqId);\n    }\n    /**\n     * 查询匹配结果, null表示结果还没出. 建议2秒一次查询. 因为请求时超时时间已知，所以客户端要做好请求超时判断\n     * @param matchReqId \n     * @returns 返回结果对象\n     */\n    public async queryMatch(playerToken: string, matchReqId: string): Promise<IResult<IMatchResult> | null> {\n        const ret = await this.client.callApi(\"QueryMatch\", {\n            playerToken: playerToken,\n            matchReqId: matchReqId,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        if (!ret.res.hasResult) return null;\n        if (ret.res.errMsg) {\n            return Result.buildErr(ret.res.errMsg, ret.res.errCode);\n        }\n        if (ret.res.matchResult) {\n            return Result.buildSucc(ret.res.matchResult);\n        }\n        return Result.buildErr(\"未知结果！\");\n    }\n    /**\n     * 取消匹配请求\n     * @param matchReqId \n     * @returns 返回结果对象\n     */\n    public async cancelMatch(playerToken: string, matchReqId: string): Promise<IResult<null>> {\n        const ret = await this.client.callApi(\"CancelMatch\", {\n            playerToken: playerToken,\n            matchReqId: matchReqId,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(null);\n    }\n\n    /**\n     * 筛选在线房间列表\n     * @param playerToken \n     * @param filter \n     * @param [skip] \n     * @param [limit] \n     */\n    public async filterRooms(playerToken: string, filter: IRoomsFilterPara, skip?: number, limit?: number): Promise<IResult<IRoomsFilterRes>> {\n        const ret = await this.client.callApi(\"FilterRooms\", {\n            playerToken,\n            filter,\n            skip,\n            limit,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res);\n    }\n    \n    /**\n     * 房主直接解散自己的房间\n     * @param playerToken \n     * @param roomId \n     */\n    public async ownDismissRoom(playerToken: string, roomId: string): Promise<IResult<IRoomOnlineInfo>> {\n        const ret = await this.client.callApi(\"OwnDismissRoom\", {\n            playerToken: playerToken,\n            roomId: roomId\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n}"]}