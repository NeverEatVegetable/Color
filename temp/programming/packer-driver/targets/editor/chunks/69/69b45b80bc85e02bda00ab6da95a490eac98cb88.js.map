{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/hallServer/api/ApiRecoverPlayerRoom.ts"],"names":["call","reqData","req","playerId","error","code","ParamsError","playerToken","ret","verificationFromId","updateShowName","succ","err","roomOnlineInfo","data","currRoomId","getRoomRet","getHallServer","gameClusterTerminal","getRoomOnlineInfo","ErrorCodes","PlayerAuthHelper"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;qBAQe,gBAAgBA,IAAhB,EAA+E;AAC1F,QAAIC,OAAO,GAAGD,IAAI,CAACE,GAAnB;;AACA,QAAI,CAACD,OAAO,CAACE,QAAb,EAAuB;AACnB,aAAO,MAAMH,IAAI,CAACI,KAAL,CAAW,gBAAX,EAA6B;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAA7B,CAAb;AACH;;AACD,QAAI,CAACL,OAAO,CAACM,WAAb,EAA0B;AACtB,aAAO,MAAMP,IAAI,CAACI,KAAL,CAAW,mBAAX,EAAgC;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAAhC,CAAb;AACH;;AACD,QAAIE,GAAG,GAAG,MAAM;AAAA;AAAA,8CAAiBC,kBAAjB,CAAoCR,OAAO,CAACE,QAA5C,EAAsDF,OAAO,CAACM,WAA9D,EAA2EN,OAAO,CAACS,cAAnF,CAAhB;;AACA,QAAI,CAACF,GAAG,CAACG,IAAT,EAAe;AACX,aAAO,MAAMX,IAAI,CAACI,KAAL,CAAWI,GAAG,CAACI,GAAf,EAAoB;AAAEP,QAAAA,IAAI,EAAEG,GAAG,CAACH;AAAZ,OAApB,CAAb;AACH;;AACD,QAAIQ,cAAsC,GAAG,IAA7C;;AACA,QAAIL,GAAG,CAACM,IAAJ,CAASC,UAAb,EAAyB;AACrB,UAAIC,UAAU,GAAG,MAAMhB,IAAI,CAACiB,aAAL,GAAqBC,mBAArB,CAAyCC,iBAAzC,CAA2DX,GAAG,CAACM,IAAJ,CAASC,UAApE,CAAvB;;AACA,UAAI,CAACC,UAAU,CAACL,IAAhB,EAAsB;AAClB,eAAO,MAAMX,IAAI,CAACI,KAAL,CAAWY,UAAU,CAACJ,GAAtB,EAA2B;AAAEP,UAAAA,IAAI,EAAEG,GAAG,CAACH;AAAZ,SAA3B,CAAb;AACH;;AACDQ,MAAAA,cAAc,GAAGG,UAAU,CAACF,IAA5B;AACH;;AACD,UAAMd,IAAI,CAACW,IAAL,CAAU;AACZE,MAAAA;AADY,KAAV,CAAN;AAGH,G;;;;;;;;AA9BQO,MAAAA,U,iBAAAA,U;;AAEAC,MAAAA,gB,iBAAAA,gB","sourcesContent":["import { ReqRecoverPlayerRoom, ResRecoverPlayerRoom } from \"../../shared/hallClient/protocols/PtlRecoverPlayerRoom\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { IRoomOnlineInfo } from \"../../shared/tsgf/room/IRoomInfo\";\nimport { PlayerAuthHelper } from \"../../shared/tsgfServer/auth/PlayerAuthHelper\";\nimport { GameServerHelper } from \"../../shared/tsgfServer/game/GameServerHelper\";\nimport { RoomHelper } from \"../../shared/tsgfServer/room/RoomHelper\";\nimport { HallApiCall } from \"../HallServer\";\n\nexport default async function (call: HallApiCall<ReqRecoverPlayerRoom, ResRecoverPlayerRoom>) {\n    let reqData = call.req;\n    if (!reqData.playerId) {\n        return await call.error('playerId 不能为空！', { code: ErrorCodes.ParamsError });\n    }\n    if (!reqData.playerToken) {\n        return await call.error('playerToken 不能为空！', { code: ErrorCodes.ParamsError });\n    }\n    let ret = await PlayerAuthHelper.verificationFromId(reqData.playerId, reqData.playerToken, reqData.updateShowName);\n    if (!ret.succ) {\n        return await call.error(ret.err, { code: ret.code });\n    }\n    let roomOnlineInfo: IRoomOnlineInfo | null = null;\n    if (ret.data.currRoomId) {\n        let getRoomRet = await call.getHallServer().gameClusterTerminal.getRoomOnlineInfo(ret.data.currRoomId)\n        if (!getRoomRet.succ) {\n            return await call.error(getRoomRet.err, { code: ret.code });\n        }\n        roomOnlineInfo = getRoomRet.data;\n    }\n    await call.succ({\n        roomOnlineInfo,\n    });\n}"]}