{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServer/api/ApiRequestFrames.ts"],"names":["ApiRequestFrames","call","req","beginFrameIndex","error","code","ParamsError","endFrameIndex","gameServer","getGameServer","gameRoom","roomMgr","getGameRoom","conn","currPlayer","RoomNotIn","game","inSync","RoomNotInSync","frames","requestFrames","succ","ErrorCodes"],"mappings":";;;;;AAKO,iBAAeA,gBAAf,CAAgCC,IAAhC,EAAuF;AAC1F,QAAIA,IAAI,CAACC,GAAL,CAASC,eAAT,GAA2B,CAA/B,EAAkC;AAC9B,aAAO,MAAMF,IAAI,CAACG,KAAL,CAAW,0BAAX,EAAuC;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAAvC,CAAb;AACH;;AACD,QAAIL,IAAI,CAACC,GAAL,CAASK,aAAT,GAAyBN,IAAI,CAACC,GAAL,CAASC,eAAtC,EAAuD;AACnD,aAAO,MAAMF,IAAI,CAACG,KAAL,CAAW,qCAAX,EAAkD;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAAlD,CAAb;AACH;;AACD,QAAIE,UAAU,GAAGP,IAAI,CAACQ,aAAL,EAAjB;AACA,QAAIC,QAAQ,GAAG,MAAMF,UAAU,CAACG,OAAX,CAAmBC,WAAnB,CAA+BX,IAAI,CAACY,IAAL,CAAUC,UAAzC,CAArB;;AACA,QAAI,CAACJ,QAAL,EAAe;AACX,aAAO,MAAMT,IAAI,CAACG,KAAL,CAAW,UAAX,EAAuB;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWU;AAAnB,OAAvB,CAAb;AACH;;AACD,QAAG,CAACL,QAAQ,CAACM,IAAT,CAAcC,MAAlB,EAAyB;AACrB,aAAO,MAAMhB,IAAI,CAACG,KAAL,CAAW,UAAX,EAAuB;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWa;AAAnB,OAAvB,CAAb;AACH;;AACD,QAAIC,MAAM,GAAGT,QAAQ,CAACM,IAAT,CAAcI,aAAd,CAA4BnB,IAAI,CAACC,GAAL,CAASC,eAArC,EAAsDF,IAAI,CAACC,GAAL,CAASK,aAA/D,CAAb;AACA,WAAO,MAAMN,IAAI,CAACoB,IAAL,CAAU;AACnBF,MAAAA,MAAM,EAAEA;AADW,KAAV,CAAb;AAGH;;;;;;;;;;;;;;;;;;8BAnBqBnB,gB;;;;;;;;AAHbsB,MAAAA,U,iBAAAA,U","sourcesContent":["\nimport { ReqRequestFrames, ResRequestFrames } from \"../../shared/gameClient/protocols/PtlRequestFrames\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { GameApiCall } from \"../GameServer\";\n\nexport async function ApiRequestFrames(call: GameApiCall<ReqRequestFrames, ResRequestFrames>) {\n    if (call.req.beginFrameIndex < 0) {\n        return await call.error('beginFrameIndex需要大于等于0 ！', { code: ErrorCodes.ParamsError });\n    }\n    if (call.req.endFrameIndex < call.req.beginFrameIndex) {\n        return await call.error('endFrameIndex需要大于等于beginFrameIndex！', { code: ErrorCodes.ParamsError });\n    }\n    let gameServer = call.getGameServer();\n    let gameRoom = await gameServer.roomMgr.getGameRoom(call.conn.currPlayer);\n    if (!gameRoom) {\n        return await call.error('玩家不在房间中！', { code: ErrorCodes.RoomNotIn });\n    }\n    if(!gameRoom.game.inSync){\n        return await call.error('当前不在同步中！', { code: ErrorCodes.RoomNotInSync });\n    }\n    let frames = gameRoom.game.requestFrames(call.req.beginFrameIndex, call.req.endFrameIndex);\n    return await call.succ({\n        frames: frames,\n    });\n}"]}