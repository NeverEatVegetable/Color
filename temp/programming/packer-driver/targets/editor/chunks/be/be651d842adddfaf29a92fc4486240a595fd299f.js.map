{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/hallServer/api/ApiOwnDismissRoom.ts"],"names":["call","t","getHallServer","gameClusterTerminal","getRet","getRoomOnlineInfo","req","roomId","succ","error","err","code","roomOnlineInfo","data","ownerPlayerId","conn","currPlayer","authInfo","playerId","RoomPermissionDenied","ret","dismissRoom","ErrorCodes"],"mappings":";;;;;;;;;;;;;;;;;;;;;qBAIe,gBAAgBA,IAAhB,EAAyE;AACpF,QAAIC,CAAC,GAAGD,IAAI,CAACE,aAAL,GAAqBC,mBAA7B;AACA,QAAIC,MAAM,GAAG,MAAMH,CAAC,CAACI,iBAAF,CAAoBL,IAAI,CAACM,GAAL,CAASC,MAA7B,CAAnB;;AACA,QAAI,CAACH,MAAM,CAACI,IAAZ,EAAkB;AACd,aAAO,MAAMR,IAAI,CAACS,KAAL,CAAWL,MAAM,CAACM,GAAlB,EAAuB;AAAEC,QAAAA,IAAI,EAAEP,MAAM,CAACO;AAAf,OAAvB,CAAb;AACH;;AACD,QAAIC,cAAc,GAAGR,MAAM,CAACS,IAA5B;;AACA,QAAID,cAAc,CAACE,aAAf,KAAiCd,IAAI,CAACe,IAAL,CAAUC,UAAV,CAAqBC,QAArB,CAA8BC,QAAnE,EAA6E;AACzE,aAAO,MAAMlB,IAAI,CAACS,KAAL,CAAW,cAAX,EAA2B;AAAEE,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWQ;AAAnB,OAA3B,CAAb;AACH;;AACD,QAAIC,GAAG,GAAG,MAAMnB,CAAC,CAACoB,WAAF,CAAcrB,IAAI,CAACM,GAAL,CAASC,MAAvB,CAAhB;;AACA,QAAI,CAACa,GAAG,CAACZ,IAAT,EAAe;AACX,aAAO,MAAMR,IAAI,CAACS,KAAL,CAAWW,GAAG,CAACV,GAAf,EAAoB;AAAEC,QAAAA,IAAI,EAAES,GAAG,CAACT;AAAZ,OAApB,CAAb;AACH;;AACD,WAAO,MAAMX,IAAI,CAACQ,IAAL,CAAU;AACnBI,MAAAA,cAAc,EAAEQ,GAAG,CAACP;AADD,KAAV,CAAb;AAGH,G;;;;;;;;AApBQS,MAAAA,U,iBAAAA,U","sourcesContent":["import { ReqOwnDismissRoom, ResOwnDismissRoom } from \"../../shared/hallClient/protocols/PtlOwnDismissRoom\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { HallApiCall } from \"../HallServer\";\n\nexport default async function (call: HallApiCall<ReqOwnDismissRoom, ResOwnDismissRoom>) {\n    let t = call.getHallServer().gameClusterTerminal;\n    let getRet = await t.getRoomOnlineInfo(call.req.roomId);\n    if (!getRet.succ) {\n        return await call.error(getRet.err, { code: getRet.code });\n    }\n    let roomOnlineInfo = getRet.data;\n    if (roomOnlineInfo.ownerPlayerId !== call.conn.currPlayer.authInfo.playerId) {\n        return await call.error('只有房主才可以解散房间！', { code: ErrorCodes.RoomPermissionDenied });\n    }\n    let ret = await t.dismissRoom(call.req.roomId);\n    if (!ret.succ) {\n        return await call.error(ret.err, { code: ret.code });\n    }\n    return await call.succ({\n        roomOnlineInfo: ret.data,\n    });\n}"]}