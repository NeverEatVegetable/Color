{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/hallServer/api/ApiAuthorize.ts"],"names":["ApiAuthorize","call","reqData","req","data","authTokenDay","error","code","ParamsError","ret","authorize","appId","openId","showName","succ","err","playerId","playerToken","ErrorCodes","PlayerAuthHelper"],"mappings":";;;;;AAKO,iBAAeA,YAAf,CAA4BC,IAA5B,EAA4E;AAC/E,QAAIC,OAAO,GAAGD,IAAI,CAACE,GAAL,CAASC,IAAvB;;AACA,QAAIF,OAAO,CAACG,YAAR,GAAuB,GAA3B,EAAgC;AAC5B,aAAO,MAAMJ,IAAI,CAACK,KAAL,CAAW,uBAAX,EAAoC;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAApC,CAAb;AACH;;AACD,QAAIC,GAAG,GAAG,MAAM;AAAA;AAAA,8CAAiBC,SAAjB,CAA2BT,IAAI,CAACE,GAAL,CAASQ,KAApC,EAA2CT,OAAO,CAACU,MAAnD,EAA2DV,OAAO,CAACW,QAAnE,EAA6EX,OAAO,CAACG,YAArF,CAAhB;;AACA,QAAI,CAACI,GAAG,CAACK,IAAT,EAAe;AACX,aAAO,MAAMb,IAAI,CAACK,KAAL,CAAWG,GAAG,CAACM,GAAf,EAAoB;AAAER,QAAAA,IAAI,EAAEE,GAAG,CAACF;AAAZ,OAApB,CAAb;AACH;;AACD,UAAMN,IAAI,CAACa,IAAL,CAAU;AACZE,MAAAA,QAAQ,EAAEP,GAAG,CAACL,IAAJ,CAASY,QADP;AAEZC,MAAAA,WAAW,EAAER,GAAG,CAACL,IAAJ,CAASa;AAFV,KAAV,CAAN;AAIH;;;;;;;;;;;;;;;;;;;;;;0BAbqBjB,Y;;;;;;;;AALbkB,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,gB,iBAAAA,gB","sourcesContent":["import { ErrorCodes, Result } from \"../../shared/tsgf/Result\";\nimport { PlayerAuthHelper } from \"../../shared/tsgfServer/auth/PlayerAuthHelper\";\nimport { ReqAuthorizeT, ResAuthorize } from \"../../shared/hallClient/protocols/PtlAuthorize\";\nimport { HallApiCall } from \"../HallServer\";\n\nexport async function ApiAuthorize(call: HallApiCall<ReqAuthorizeT, ResAuthorize>) {\n    let reqData = call.req.data;\n    if (reqData.authTokenDay > 120) {\n        return await call.error('authTokenDay 范围1~120！', { code: ErrorCodes.ParamsError });\n    }\n    let ret = await PlayerAuthHelper.authorize(call.req.appId, reqData.openId, reqData.showName, reqData.authTokenDay);\n    if (!ret.succ) {\n        return await call.error(ret.err, { code: ret.code });\n    }\n    await call.succ({\n        playerId: ret.data.playerId,\n        playerToken: ret.data.playerToken,\n    });\n}"]}