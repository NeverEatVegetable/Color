{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServerCluster/api/ApiTerminalGetOrCreateRoom.ts"],"names":["call","req","matchRoomType","matchMaxPlayers","error","code","ParamsError","getOrAllotRet","getGameClusterServer","roomMgr","getOrAllotGameServer","appId","succ","err","data","matchRoomOnlineInfoList","length","createRoomOnlineInfo","Exception","ErrorCodes"],"mappings":";;;;;;;;;;;;;;;;;;;;;qBAIe,gBAAgBA,IAAhB,EAAkG;AAAA;;AAE7G,QAAI,CAACA,IAAI,CAACC,GAAL,CAASC,aAAV,IAA2B,CAACF,IAAI,CAACC,GAAL,CAASE,eAAzC,EAA0D;AACtD,aAAO,MAAMH,IAAI,CAACI,KAAL,CAAW,gBAAX,EAA6B;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWC;AAAnB,OAA7B,CAAb;AACH;;AACD,QAAIC,aAAa,GAAG,MAAMP,IAAI,CAACQ,oBAAL,GAA4BC,OAA5B,CAAoCC,oBAApC,CAAyDV,IAAI,CAACC,GAAL,CAASU,KAAlE,EAAwEX,IAAI,CAACC,GAA7E,CAA1B;;AACA,QAAI,CAACM,aAAa,CAACK,IAAnB,EAAyB;AACrB,aAAO,MAAMZ,IAAI,CAACI,KAAL,CAAWG,aAAa,CAACM,GAAzB,EAA8B;AAAER,QAAAA,IAAI,EAAEE,aAAa,CAACF;AAAtB,OAA9B,CAAb;AACH;;AACD,iCAAIE,aAAa,CAACO,IAAd,CAAmBC,uBAAvB,aAAI,sBAA4CC,MAAhD,EAAwD;AACpD;AACA,aAAO,MAAMhB,IAAI,CAACY,IAAL,CAAU;AACnBG,QAAAA,uBAAuB,EAAER,aAAa,CAACO,IAAd,CAAmBC;AADzB,OAAV,CAAb;AAGH;;AACD,QAAIR,aAAa,CAACO,IAAd,CAAmBG,oBAAvB,EAA6C;AACzC;AACA,aAAO,MAAMjB,IAAI,CAACY,IAAL,CAAU;AACnBK,QAAAA,oBAAoB,EAAEV,aAAa,CAACO,IAAd,CAAmBG;AADtB,OAAV,CAAb;AAGH;;AACD,WAAO,MAAMjB,IAAI,CAACI,KAAL,CAAW,OAAX,EAAoB;AAAEC,MAAAA,IAAI,EAAE;AAAA;AAAA,oCAAWa;AAAnB,KAApB,CAAb;AACH,G;;;;;;;;AA1BQC,MAAAA,U,iBAAAA,U","sourcesContent":["import { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { ReqTerminalGetOrCreateRoom, ResTerminalGetOrCreateRoom } from \"../../shared/tsgfServer/gameCluster/protocols/PtlTerminalGetOrCreateRoom\";\nimport { GameClusterApiCall } from \"../GameServerClusterMgr\";\n\nexport default async function (call: GameClusterApiCall<ReqTerminalGetOrCreateRoom, ResTerminalGetOrCreateRoom>) {\n    \n    if (!call.req.matchRoomType && !call.req.matchMaxPlayers) {\n        return await call.error('match参数至少要有一个!', { code: ErrorCodes.ParamsError });\n    }\n    let getOrAllotRet = await call.getGameClusterServer().roomMgr.getOrAllotGameServer(call.req.appId,call.req);\n    if (!getOrAllotRet.succ) {\n        return await call.error(getOrAllotRet.err, { code: getOrAllotRet.code });\n    }\n    if (getOrAllotRet.data.matchRoomOnlineInfoList?.length) {\n        // 匹配到现有房间\n        return await call.succ({\n            matchRoomOnlineInfoList: getOrAllotRet.data.matchRoomOnlineInfoList,\n        });\n    }\n    if (getOrAllotRet.data.createRoomOnlineInfo) {\n        // 成功创建房间\n        return await call.succ({\n            createRoomOnlineInfo: getOrAllotRet.data.createRoomOnlineInfo,\n        });\n    }\n    return await call.error('结果异常！', { code: ErrorCodes.Exception });\n}"]}