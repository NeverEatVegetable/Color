{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServer/ConnectionCollection.ts"],"names":["ConnectionCollection","connections","_conns","connectionMap","_connMap","constructor","getConnKey","Map","addConnection","conn","k","removeConnection","set","push","connKey","delete","remove","c","clearAllConnections","clear"],"mappings":";;;8BAKaA,oB;;;;;;;;;;;;;;;;;;;AADb;sCACaA,oB,GAAN,MAAMA,oBAAN,CAA2B;AAM9B;AACsB,YAAXC,WAAW,GAAG;AACrB,iBAAO,KAAKC,MAAZ;AACH;AACD;;;AACwB,YAAbC,aAAa,GAAG;AACvB,iBAAO,KAAKC,QAAZ;AACH;AAGD;AACJ;AACA;AACA;;;AACIC,QAAAA,WAAW,CAACC,UAAD,EAAiD;AAAA,eAlBlDJ,MAkBkD,GAlBrB,EAkBqB;AAAA,eAjBlDE,QAiBkD,GAjBR,IAAIG,GAAJ,EAiBQ;AAAA,eAhBlDD,UAgBkD;AACxD,eAAKA,UAAL,GAAkBA,UAAlB;AACH;AAED;AACJ;AACA;AACA;;;AACWE,QAAAA,aAAa,CAACC,IAAD,EAA+B;AAC/C,cAAIC,CAAC,GAAG,KAAKJ,UAAL,CAAgBG,IAAhB,CAAR;AACA,cAAI,CAACC,CAAL,EAAQ;AACR,eAAKC,gBAAL,CAAsBD,CAAtB;;AACA,eAAKN,QAAL,CAAcQ,GAAd,CAAkBF,CAAlB,EAAqBD,IAArB;;AACA,eAAKP,MAAL,CAAYW,IAAZ,CAAiBJ,IAAjB;AACH;AACD;AACJ;AACA;AACA;;;AACWE,QAAAA,gBAAgB,CAACG,OAAD,EAAwB;AAC3C,eAAKV,QAAL,CAAcW,MAAd,CAAqBD,OAArB;;AACA,eAAKZ,MAAL,CAAYc,MAAZ,CAAmBC,CAAC,IAAI,KAAKX,UAAL,CAAgBW,CAAhB,MAAuBH,OAA/C;AACH;AAED;;;AACOI,QAAAA,mBAAmB,GAAS;AAC/B,eAAKd,QAAL,CAAce,KAAd;;AACA,eAAKjB,MAAL,GAAc,EAAd;AACH;;AAhD6B,O","sourcesContent":["import { v4 } from \"uuid\";\nimport { ClientConnection } from \"./GameServer\";\n\n\n/**连接的集合*/\nexport class ConnectionCollection {\n\n    protected _conns: ClientConnection[] = [];\n    protected _connMap: Map<string, ClientConnection> = new Map<string, ClientConnection>();\n    protected getConnKey: (conn: ClientConnection) => string | undefined;\n\n    /**集合内的连接数组*/\n    public get connections() {\n        return this._conns;\n    }\n    /**集合内的连接字典,连接标识=>连接对象*/\n    public get connectionMap() {\n        return this._connMap;\n    }\n\n\n    /**\n     *\n     * @param getConnKey 获取连接标识,可以用connId也可以用其他\n     */\n    constructor(getConnKey: (conn: ClientConnection) => string) {\n        this.getConnKey = getConnKey;\n    }\n\n    /**\n     * 加入连接\n     * @param conn \n     */\n    public addConnection(conn: ClientConnection): void {\n        let k = this.getConnKey(conn);\n        if (!k) return;\n        this.removeConnection(k);\n        this._connMap.set(k, conn);\n        this._conns.push(conn);\n    }\n    /**\n     * 移除指定连接\n     * @param conn \n     */\n    public removeConnection(connKey: string): void {\n        this._connMap.delete(connKey);\n        this._conns.remove(c => this.getConnKey(c) === connKey);\n    }\n\n    /**清除所有连接*/\n    public clearAllConnections(): void {\n        this._connMap.clear();\n        this._conns = [];\n    }\n}\n"]}