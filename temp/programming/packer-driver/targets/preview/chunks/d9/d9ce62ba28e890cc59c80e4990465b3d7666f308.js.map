{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/hallServer/api/ApiAuthorize.ts"],"names":["ApiAuthorize","call","reqData","req","data","authTokenDay","error","code","ParamsError","ret","authorize","appId","openId","showName","succ","err","playerId","playerToken","ErrorCodes","PlayerAuthHelper"],"mappings":";;;;;;;;;WAKsBA,Y;;;;;sCAAf,WAA4BC,IAA5B,EAA4E;AAC/E,UAAIC,OAAO,GAAGD,IAAI,CAACE,GAAL,CAASC,IAAvB;;AACA,UAAIF,OAAO,CAACG,YAAR,GAAuB,GAA3B,EAAgC;AAC5B,qBAAaJ,IAAI,CAACK,KAAL,CAAW,uBAAX,EAAoC;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAApC,CAAb;AACH;;AACD,UAAIC,GAAG,SAAS;AAAA;AAAA,gDAAiBC,SAAjB,CAA2BT,IAAI,CAACE,GAAL,CAASQ,KAApC,EAA2CT,OAAO,CAACU,MAAnD,EAA2DV,OAAO,CAACW,QAAnE,EAA6EX,OAAO,CAACG,YAArF,CAAhB;;AACA,UAAI,CAACI,GAAG,CAACK,IAAT,EAAe;AACX,qBAAab,IAAI,CAACK,KAAL,CAAWG,GAAG,CAACM,GAAf,EAAoB;AAAER,UAAAA,IAAI,EAAEE,GAAG,CAACF;AAAZ,SAApB,CAAb;AACH;;AACD,YAAMN,IAAI,CAACa,IAAL,CAAU;AACZE,QAAAA,QAAQ,EAAEP,GAAG,CAACL,IAAJ,CAASY,QADP;AAEZC,QAAAA,WAAW,EAAER,GAAG,CAACL,IAAJ,CAASa;AAFV,OAAV,CAAN;AAIH,K;;;;;;;;;;;;;;;;;;;;;;;;0BAbqBjB,Y;;;;;;;;AALbkB,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,gB,iBAAAA,gB","sourcesContent":["import { ErrorCodes, Result } from \"../../shared/tsgf/Result\";\nimport { PlayerAuthHelper } from \"../../shared/tsgfServer/auth/PlayerAuthHelper\";\nimport { ReqAuthorizeT, ResAuthorize } from \"../../shared/hallClient/protocols/PtlAuthorize\";\nimport { HallApiCall } from \"../HallServer\";\n\nexport async function ApiAuthorize(call: HallApiCall<ReqAuthorizeT, ResAuthorize>) {\n    let reqData = call.req.data;\n    if (reqData.authTokenDay > 120) {\n        return await call.error('authTokenDay 范围1~120！', { code: ErrorCodes.ParamsError });\n    }\n    let ret = await PlayerAuthHelper.authorize(call.req.appId, reqData.openId, reqData.showName, reqData.authTokenDay);\n    if (!ret.succ) {\n        return await call.error(ret.err, { code: ret.code });\n    }\n    await call.succ({\n        playerId: ret.data.playerId,\n        playerToken: ret.data.playerToken,\n    });\n}"]}