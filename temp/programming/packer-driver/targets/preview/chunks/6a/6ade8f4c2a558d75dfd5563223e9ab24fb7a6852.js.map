{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServer/api/ApiRequestFrames.ts"],"names":["ApiRequestFrames","call","req","beginFrameIndex","error","code","ParamsError","endFrameIndex","gameServer","getGameServer","gameRoom","roomMgr","getGameRoom","conn","currPlayer","RoomNotIn","game","inSync","RoomNotInSync","frames","requestFrames","succ","ErrorCodes"],"mappings":";;;;;;;;;WAKsBA,gB;;;;;0CAAf,WAAgCC,IAAhC,EAAuF;AAC1F,UAAIA,IAAI,CAACC,GAAL,CAASC,eAAT,GAA2B,CAA/B,EAAkC;AAC9B,qBAAaF,IAAI,CAACG,KAAL,CAAW,0BAAX,EAAuC;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAAvC,CAAb;AACH;;AACD,UAAIL,IAAI,CAACC,GAAL,CAASK,aAAT,GAAyBN,IAAI,CAACC,GAAL,CAASC,eAAtC,EAAuD;AACnD,qBAAaF,IAAI,CAACG,KAAL,CAAW,qCAAX,EAAkD;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAAlD,CAAb;AACH;;AACD,UAAIE,UAAU,GAAGP,IAAI,CAACQ,aAAL,EAAjB;AACA,UAAIC,QAAQ,SAASF,UAAU,CAACG,OAAX,CAAmBC,WAAnB,CAA+BX,IAAI,CAACY,IAAL,CAAUC,UAAzC,CAArB;;AACA,UAAI,CAACJ,QAAL,EAAe;AACX,qBAAaT,IAAI,CAACG,KAAL,CAAW,UAAX,EAAuB;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWU;AAAnB,SAAvB,CAAb;AACH;;AACD,UAAG,CAACL,QAAQ,CAACM,IAAT,CAAcC,MAAlB,EAAyB;AACrB,qBAAahB,IAAI,CAACG,KAAL,CAAW,UAAX,EAAuB;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWa;AAAnB,SAAvB,CAAb;AACH;;AACD,UAAIC,MAAM,GAAGT,QAAQ,CAACM,IAAT,CAAcI,aAAd,CAA4BnB,IAAI,CAACC,GAAL,CAASC,eAArC,EAAsDF,IAAI,CAACC,GAAL,CAASK,aAA/D,CAAb;AACA,mBAAaN,IAAI,CAACoB,IAAL,CAAU;AACnBF,QAAAA,MAAM,EAAEA;AADW,OAAV,CAAb;AAGH,K;;;;;;;;;;;;;;;;;;;;8BAnBqBnB,gB;;;;;;;;AAHbsB,MAAAA,U,iBAAAA,U","sourcesContent":["\nimport { ReqRequestFrames, ResRequestFrames } from \"../../shared/gameClient/protocols/PtlRequestFrames\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { GameApiCall } from \"../GameServer\";\n\nexport async function ApiRequestFrames(call: GameApiCall<ReqRequestFrames, ResRequestFrames>) {\n    if (call.req.beginFrameIndex < 0) {\n        return await call.error('beginFrameIndex需要大于等于0 ！', { code: ErrorCodes.ParamsError });\n    }\n    if (call.req.endFrameIndex < call.req.beginFrameIndex) {\n        return await call.error('endFrameIndex需要大于等于beginFrameIndex！', { code: ErrorCodes.ParamsError });\n    }\n    let gameServer = call.getGameServer();\n    let gameRoom = await gameServer.roomMgr.getGameRoom(call.conn.currPlayer);\n    if (!gameRoom) {\n        return await call.error('玩家不在房间中！', { code: ErrorCodes.RoomNotIn });\n    }\n    if(!gameRoom.game.inSync){\n        return await call.error('当前不在同步中！', { code: ErrorCodes.RoomNotInSync });\n    }\n    let frames = gameRoom.game.requestFrames(call.req.beginFrameIndex, call.req.endFrameIndex);\n    return await call.succ({\n        frames: frames,\n    });\n}"]}