{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServer/api/ApiReconnect.ts"],"names":["ApiReconnect","call","gameServer","getGameServer","ret","gameConnMgr","connReconnect","conn","req","playerToken","roomWaitReconnectTime","succ","err","code","AuthReconnectionFail","roomInfo","roomMgr","getRoomInfo","currPlayer","playerId","playerInfo","currRoomInfo","apiErrorThenClose","ErrorCodes"],"mappings":";;;;;;;;;WAMsBA,Y;;;;;sCAAf,WAA4BC,IAA5B,EAA2E;AAC9E,UAAIC,UAAU,GAAGD,IAAI,CAACE,aAAL,EAAjB;AACA,UAAIC,GAAG,SAASF,UAAU,CAACG,WAAX,CAAuBC,aAAvB,CAAqCL,IAAI,CAACM,IAA1C,EAAgDN,IAAI,CAACO,GAAL,CAASC,WAAzD,EAAsER,IAAI,CAACO,GAAL,CAASE,qBAA/E,CAAhB;;AACA,UAAI,CAACN,GAAG,CAACO,IAAT,EAAe;AACX;AACA,qBAAa;AAAA;AAAA,oDAAkBV,IAAlB,EAAwBG,GAAG,CAACQ,GAA5B,EAAiC;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAAjC,CAAb;AACH;;AAED,UAAIC,QAAQ,SAASb,UAAU,CAACc,OAAX,CAAmBC,WAAnB,CAA+BhB,IAAI,CAACM,IAAL,CAAUW,UAAzC,CAArB;AACA,YAAMjB,IAAI,CAACU,IAAL,CAAU;AACZQ,QAAAA,QAAQ,EAAElB,IAAI,CAACM,IAAL,CAAUW,UAAV,CAAqBE,UAArB,CAAgCD,QAD9B;AAEZE,QAAAA,YAAY,EAAEN;AAFF,OAAV,CAAN;AAIH,K;;;;;;;;;;;;;;;;;;;;;;;;0BAbqBf,Y;;;;;;;;AALbsB,MAAAA,iB,iBAAAA,iB;;AAGAC,MAAAA,U,iBAAAA,U","sourcesContent":["\nimport { apiErrorThenClose } from \"../../shared/tsgfServer/ApiBase\";\nimport { ReqReconnect, ResReconnect } from \"../../shared/gameClient/protocols/PtlReconnect\";\nimport { GameApiCall } from \"../GameServer\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\n\nexport async function ApiReconnect(call: GameApiCall<ReqReconnect, ResReconnect>) {\n    let gameServer = call.getGameServer();\n    let ret = await gameServer.gameConnMgr.connReconnect(call.conn, call.req.playerToken, call.req.roomWaitReconnectTime);\n    if (!ret.succ) {\n        //拒绝继续重连尝试了,要求重新登录!\n        return await apiErrorThenClose(call, ret.err, { code: ErrorCodes.AuthReconnectionFail });\n    }\n\n    let roomInfo = await gameServer.roomMgr.getRoomInfo(call.conn.currPlayer);\n    await call.succ({\n        playerId: call.conn.currPlayer.playerInfo.playerId,\n        currRoomInfo: roomInfo\n    });\n}"]}