{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/test/unitTest/api/Traefik.test.ts"],"names":["assert","delay","authToGameServer","createHallClient","authPlayerTokenByHallClient","describe","test","hallClient","authRet","testData","playerId1","playerId","playerToken1","playerToken","createRet","createRoom","roomName","maxPlayers","ownerPlayerId","isPrivate","ok","succ","err","roomOnlineInfo","data","gameClient","gameServerUrl","joinRet","joinRoom","roomId","regRet","getRoomOnlineInfo","disconnect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,M,SAAAA,M;;AAEAC,MAAAA,K,iBAAAA,K;;AACiBC,MAAAA,gB,iBAAAA,gB;AAAiFC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,2B,iBAAAA,2B;;;;;;;AAE7HC,MAAAA,QAAQ,CAAC,SAAD,EAAY,MAAM;AACtBC,QAAAA,IAAI,CAAC,OAAD,iCAAU,aAAkB,CAAG,CAA/B,EAAJ;AACA,eAFsB,CAEf;AACP;;AAEAA,QAAAA,IAAI,CAAC,WAAD,iCAAc,aAAkB;AAChC,cAAMC,UAAU,GAAG;AAAA;AAAA,oDAAiB,+BAAjB,CAAnB;AACA,cAAIC,OAAO,SAAS;AAAA;AAAA,0EAA4BD,UAA5B,EAAwC,MAAxC,EAAgD,MAAhD,CAApB,CAFgC,CAIhC;;AACA,cAAIE,QAAkB,GAAG;AACrBC,YAAAA,SAAS,EAAEF,OAAO,CAACG,QADE;AAErBC,YAAAA,YAAY,EAAEJ,OAAO,CAACK;AAFD,WAAzB,CALgC,CAShC;;AACA,cAAIC,SAAS,SAASP,UAAU,CAACQ,UAAX,CAAsBN,QAAQ,CAACG,YAA/B,EAA6C;AAC/DI,YAAAA,QAAQ,EAAE,MADqD;AAE/DC,YAAAA,UAAU,EAAE,CAFmD;AAG/DC,YAAAA,aAAa,EAAET,QAAQ,CAACC,SAHuC;AAI/DS,YAAAA,SAAS,EAAE;AAJoD,WAA7C,CAAtB;AAMA;AAAA;AAAA,gCAAOC,EAAP,CAAUN,SAAS,CAACO,IAApB,EAA0BP,SAAS,CAACQ,GAApC;AACA,cAAIC,cAAc,GAAGT,SAAS,CAACU,IAA/B,CAjBgC,CAmBhC;;AACA,cAAIC,UAAU,SAAS;AAAA;AAAA,oDAAiB,MAAjB,EAAyBhB,QAAQ,CAACG,YAAlC,EAAgDW,cAAc,CAACG,aAA/D,EAA+E,CAA/E,CAAvB,CApBgC,CAqBhC;;AACA,cAAIC,OAAO,SAASF,UAAU,CAACG,QAAX,CAAoB;AAAEC,YAAAA,MAAM,EAAEN,cAAc,CAACM;AAAzB,WAApB,CAApB;AACA;AAAA;AAAA,gCAAOT,EAAP,CAAUO,OAAO,CAACN,IAAlB,EAAwBM,OAAO,CAACL,GAAhC;AAEA,gBAAM;AAAA;AAAA,8BAAM,GAAN,CAAN;AAEA,cAAIQ,MAAM,SAASvB,UAAU,CAACwB,iBAAX,CAA6BtB,QAAQ,CAACG,YAAtC,EAAoDW,cAAc,CAACM,MAAnE,CAAnB;AACA;AAAA;AAAA,gCAAOT,EAAP,CAAUU,MAAM,CAACT,IAAjB,EAAuBS,MAAM,CAACR,GAA9B;AAEA,gBAAMG,UAAU,CAACO,UAAX,EAAN;AAEH,SAhCG,EAAJ;AAiCH,OAtCO,CAAR","sourcesContent":["import { assert } from \"chai\";\nimport { ErrorCodes } from \"../../../src/shared/tsgf/Result\";\nimport { delay } from \"../../../src/shared/tsgf/Utils\";\nimport { authPlayerToken, authToGameServer, createAndEnterRoom, hallClient, appDismissRoom, testEachBuild, createHallClient, authPlayerTokenByHallClient, TestData } from \"./ApiUtils\";\n\ndescribe(\"Traefik\", () => {\n    test('empty', async function () { });\n    return;// 防止被批量执行这里return, 需要单独跑的时候再启用\n    // 需要启动 npm run runAllInOne + traefik服务 + hosts解析本地 作为单元测试环境\n\n    test('简单走一下基本接口', async function () {\n        const hallClient = createHallClient('http://tsgf-hall.iclouden.com');\n        let authRet = await authPlayerTokenByHallClient(hallClient, 'zum1', 'zum1');\n    \n        // @ts-ignore\n        let testData: TestData = {\n            playerId1: authRet.playerId,\n            playerToken1: authRet.playerToken,\n        };\n        //创建单人房间\n        let createRet = await hallClient.createRoom(testData.playerToken1, {\n            roomName: 'test',\n            maxPlayers: 2,\n            ownerPlayerId: testData.playerId1,\n            isPrivate: true,\n        });\n        assert.ok(createRet.succ, createRet.err);\n        let roomOnlineInfo = createRet.data!;\n\n        //连接游戏服务器\n        let gameClient = await authToGameServer('zum1', testData.playerToken1, roomOnlineInfo.gameServerUrl!, 0);\n        //加入自己创建的房间\n        let joinRet = await gameClient.joinRoom({ roomId: roomOnlineInfo.roomId });\n        assert.ok(joinRet.succ, joinRet.err);\n\n        await delay(500);\n\n        let regRet = await hallClient.getRoomOnlineInfo(testData.playerToken1, roomOnlineInfo.roomId);\n        assert.ok(regRet.succ, regRet.err);\n\n        await gameClient.disconnect();\n\n    });\n});"]}