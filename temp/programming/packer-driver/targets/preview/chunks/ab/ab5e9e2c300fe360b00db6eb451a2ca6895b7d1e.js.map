{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/gameServerCluster/api/ApiTerminalGetOrCreateRoom.ts"],"names":["call","req","matchRoomType","matchMaxPlayers","error","code","ParamsError","getOrAllotRet","getGameClusterServer","roomMgr","getOrAllotGameServer","appId","succ","err","data","matchRoomOnlineInfoList","length","createRoomOnlineInfo","Exception","ErrorCodes"],"mappings":";;;;;;;;;;6BAIe,WAAgBA,IAAhB,EAAkG;AAAA;;AAE7G,UAAI,CAACA,IAAI,CAACC,GAAL,CAASC,aAAV,IAA2B,CAACF,IAAI,CAACC,GAAL,CAASE,eAAzC,EAA0D;AACtD,qBAAaH,IAAI,CAACI,KAAL,CAAW,gBAAX,EAA6B;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAA7B,CAAb;AACH;;AACD,UAAIC,aAAa,SAASP,IAAI,CAACQ,oBAAL,GAA4BC,OAA5B,CAAoCC,oBAApC,CAAyDV,IAAI,CAACC,GAAL,CAASU,KAAlE,EAAwEX,IAAI,CAACC,GAA7E,CAA1B;;AACA,UAAI,CAACM,aAAa,CAACK,IAAnB,EAAyB;AACrB,qBAAaZ,IAAI,CAACI,KAAL,CAAWG,aAAa,CAACM,GAAzB,EAA8B;AAAER,UAAAA,IAAI,EAAEE,aAAa,CAACF;AAAtB,SAA9B,CAAb;AACH;;AACD,mCAAIE,aAAa,CAACO,IAAd,CAAmBC,uBAAvB,aAAI,sBAA4CC,MAAhD,EAAwD;AACpD;AACA,qBAAahB,IAAI,CAACY,IAAL,CAAU;AACnBG,UAAAA,uBAAuB,EAAER,aAAa,CAACO,IAAd,CAAmBC;AADzB,SAAV,CAAb;AAGH;;AACD,UAAIR,aAAa,CAACO,IAAd,CAAmBG,oBAAvB,EAA6C;AACzC;AACA,qBAAajB,IAAI,CAACY,IAAL,CAAU;AACnBK,UAAAA,oBAAoB,EAAEV,aAAa,CAACO,IAAd,CAAmBG;AADtB,SAAV,CAAb;AAGH;;AACD,mBAAajB,IAAI,CAACI,KAAL,CAAW,OAAX,EAAoB;AAAEC,QAAAA,IAAI,EAAE;AAAA;AAAA,sCAAWa;AAAnB,OAApB,CAAb;AACH,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA1BQC,MAAAA,U,iBAAAA,U","sourcesContent":["import { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { ReqTerminalGetOrCreateRoom, ResTerminalGetOrCreateRoom } from \"../../shared/tsgfServer/gameCluster/protocols/PtlTerminalGetOrCreateRoom\";\nimport { GameClusterApiCall } from \"../GameServerClusterMgr\";\n\nexport default async function (call: GameClusterApiCall<ReqTerminalGetOrCreateRoom, ResTerminalGetOrCreateRoom>) {\n    \n    if (!call.req.matchRoomType && !call.req.matchMaxPlayers) {\n        return await call.error('match参数至少要有一个!', { code: ErrorCodes.ParamsError });\n    }\n    let getOrAllotRet = await call.getGameClusterServer().roomMgr.getOrAllotGameServer(call.req.appId,call.req);\n    if (!getOrAllotRet.succ) {\n        return await call.error(getOrAllotRet.err, { code: getOrAllotRet.code });\n    }\n    if (getOrAllotRet.data.matchRoomOnlineInfoList?.length) {\n        // 匹配到现有房间\n        return await call.succ({\n            matchRoomOnlineInfoList: getOrAllotRet.data.matchRoomOnlineInfoList,\n        });\n    }\n    if (getOrAllotRet.data.createRoomOnlineInfo) {\n        // 成功创建房间\n        return await call.succ({\n            createRoomOnlineInfo: getOrAllotRet.data.createRoomOnlineInfo,\n        });\n    }\n    return await call.error('结果异常！', { code: ErrorCodes.Exception });\n}"]}