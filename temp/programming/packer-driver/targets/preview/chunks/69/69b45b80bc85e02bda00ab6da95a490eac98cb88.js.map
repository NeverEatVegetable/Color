{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/hallServer/api/ApiRecoverPlayerRoom.ts"],"names":["call","reqData","req","playerId","error","code","ParamsError","playerToken","ret","verificationFromId","updateShowName","succ","err","roomOnlineInfo","data","currRoomId","getRoomRet","getHallServer","gameClusterTerminal","getRoomOnlineInfo","ErrorCodes","PlayerAuthHelper"],"mappings":";;;;;;;;;;6BAQe,WAAgBA,IAAhB,EAA+E;AAC1F,UAAIC,OAAO,GAAGD,IAAI,CAACE,GAAnB;;AACA,UAAI,CAACD,OAAO,CAACE,QAAb,EAAuB;AACnB,qBAAaH,IAAI,CAACI,KAAL,CAAW,gBAAX,EAA6B;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAA7B,CAAb;AACH;;AACD,UAAI,CAACL,OAAO,CAACM,WAAb,EAA0B;AACtB,qBAAaP,IAAI,CAACI,KAAL,CAAW,mBAAX,EAAgC;AAAEC,UAAAA,IAAI,EAAE;AAAA;AAAA,wCAAWC;AAAnB,SAAhC,CAAb;AACH;;AACD,UAAIE,GAAG,SAAS;AAAA;AAAA,gDAAiBC,kBAAjB,CAAoCR,OAAO,CAACE,QAA5C,EAAsDF,OAAO,CAACM,WAA9D,EAA2EN,OAAO,CAACS,cAAnF,CAAhB;;AACA,UAAI,CAACF,GAAG,CAACG,IAAT,EAAe;AACX,qBAAaX,IAAI,CAACI,KAAL,CAAWI,GAAG,CAACI,GAAf,EAAoB;AAAEP,UAAAA,IAAI,EAAEG,GAAG,CAACH;AAAZ,SAApB,CAAb;AACH;;AACD,UAAIQ,cAAsC,GAAG,IAA7C;;AACA,UAAIL,GAAG,CAACM,IAAJ,CAASC,UAAb,EAAyB;AACrB,YAAIC,UAAU,SAAShB,IAAI,CAACiB,aAAL,GAAqBC,mBAArB,CAAyCC,iBAAzC,CAA2DX,GAAG,CAACM,IAAJ,CAASC,UAApE,CAAvB;;AACA,YAAI,CAACC,UAAU,CAACL,IAAhB,EAAsB;AAClB,uBAAaX,IAAI,CAACI,KAAL,CAAWY,UAAU,CAACJ,GAAtB,EAA2B;AAAEP,YAAAA,IAAI,EAAEG,GAAG,CAACH;AAAZ,WAA3B,CAAb;AACH;;AACDQ,QAAAA,cAAc,GAAGG,UAAU,CAACF,IAA5B;AACH;;AACD,YAAMd,IAAI,CAACW,IAAL,CAAU;AACZE,QAAAA;AADY,OAAV,CAAN;AAGH,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA9BQO,MAAAA,U,iBAAAA,U;;AAEAC,MAAAA,gB,iBAAAA,gB","sourcesContent":["import { ReqRecoverPlayerRoom, ResRecoverPlayerRoom } from \"../../shared/hallClient/protocols/PtlRecoverPlayerRoom\";\nimport { ErrorCodes } from \"../../shared/tsgf/Result\";\nimport { IRoomOnlineInfo } from \"../../shared/tsgf/room/IRoomInfo\";\nimport { PlayerAuthHelper } from \"../../shared/tsgfServer/auth/PlayerAuthHelper\";\nimport { GameServerHelper } from \"../../shared/tsgfServer/game/GameServerHelper\";\nimport { RoomHelper } from \"../../shared/tsgfServer/room/RoomHelper\";\nimport { HallApiCall } from \"../HallServer\";\n\nexport default async function (call: HallApiCall<ReqRecoverPlayerRoom, ResRecoverPlayerRoom>) {\n    let reqData = call.req;\n    if (!reqData.playerId) {\n        return await call.error('playerId 不能为空！', { code: ErrorCodes.ParamsError });\n    }\n    if (!reqData.playerToken) {\n        return await call.error('playerToken 不能为空！', { code: ErrorCodes.ParamsError });\n    }\n    let ret = await PlayerAuthHelper.verificationFromId(reqData.playerId, reqData.playerToken, reqData.updateShowName);\n    if (!ret.succ) {\n        return await call.error(ret.err, { code: ret.code });\n    }\n    let roomOnlineInfo: IRoomOnlineInfo | null = null;\n    if (ret.data.currRoomId) {\n        let getRoomRet = await call.getHallServer().gameClusterTerminal.getRoomOnlineInfo(ret.data.currRoomId)\n        if (!getRoomRet.succ) {\n            return await call.error(getRoomRet.err, { code: ret.code });\n        }\n        roomOnlineInfo = getRoomRet.data;\n    }\n    await call.succ({\n        roomOnlineInfo,\n    });\n}"]}