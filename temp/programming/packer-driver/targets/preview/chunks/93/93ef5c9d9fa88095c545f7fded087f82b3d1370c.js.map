{"version":3,"sources":["file:///E:/CocosProjects/Color/assets/ts-gameframework-master/servers/src/shared/tsgfServer/gameCluster/GameClusterTerminal.ts"],"names":["GameClusterTerminal","ErrorCodes","Result","ClusterNodeClient","EClusterClientType","gameClusterServiceProto","serviceProto","terminalClient","clusterClient","constructor","clusterServerUrl","terminalId","terminalKey","Terminal","createRoom","appId","createRoomPara","createType","buildErr","AuthUnverified","ret","callApi","isSucc","err","message","code","buildSucc","res","roomOnlineInfo","dismissRoom","roomId","getRoomOnlineInfo","getOrCreateRoom","getOrCreateRoomPara","filterRooms","filter","skip","limit"],"mappings":"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","sourcesContent":["import { WsClient } from \"tsrpc\";\nimport { ErrorCodes, IResult, Result } from \"../../tsgf/Result\";\nimport { ERoomCreateType, ICreateRoomPara, IGetOrCreateRoomPara, IGetOrCreateRoomRsp, IRoomOnlineInfo, IRoomsFilterPara, IRoomsFilterRes } from \"../../tsgf/room/IRoomInfo\";\nimport { ClusterNodeClient } from \"../cluster/ClusterNodeClient\";\nimport { EClusterClientType } from \"../cluster/Models\";\nimport { IGameServerInfoInServer } from \"../game/Models\";\nimport { IRoomRegInfo } from \"../room/Models\";\nimport { ServiceType as GameClusterServiceType, serviceProto as gameClusterServiceProto } from \"./protocols/serviceProto\";\n\nexport class GameClusterTerminal extends ClusterNodeClient<GameClusterServiceType, IGameServerInfoInServer>{\n\n    protected get terminalClient(): WsClient<GameClusterServiceType> | undefined {\n        return this.clusterClient as WsClient<GameClusterServiceType> | undefined;\n    }\n\n    constructor(\n        clusterServerUrl: string, terminalId: string, terminalKey: string\n    ) {\n        super(gameClusterServiceProto, clusterServerUrl, EClusterClientType.Terminal, terminalId, terminalKey);\n    }\n\n\n\n    public async createRoom(appId: string, createRoomPara: ICreateRoomPara, createType: ERoomCreateType): Promise<IResult<IRoomOnlineInfo>> {\n        if (!this.terminalClient) return Result.buildErr('当前服务器断开！请稍后再试！', ErrorCodes.AuthUnverified);\n\n        let ret = await this.terminalClient.callApi('TerminalCreateRoom', {\n            ...createRoomPara,\n            appId,\n            createType,\n        });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err?.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n    /**\n     * 要求集群解散房间\n     * @param roomId \n     * @returns room \n     */\n    public async dismissRoom(roomId: string): Promise<IResult<IRoomOnlineInfo>> {\n        if (!this.terminalClient) return Result.buildErr('当前服务器断开！请稍后再试！', ErrorCodes.AuthUnverified);\n\n        let ret = await this.terminalClient.callApi('TerminalDismissRoom', { roomId });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err?.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n    /**\n     * 获取房间在线信息\n     * @param roomId \n     * @returns room \n     */\n    public async getRoomOnlineInfo(roomId: string): Promise<IResult<IRoomOnlineInfo>> {\n        if (!this.terminalClient) return Result.buildErr('当前服务器断开！请稍后再试！', ErrorCodes.AuthUnverified);\n\n        let ret = await this.terminalClient.callApi('TerminalGetRoomOnlineInfo', { roomId });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err?.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res.roomOnlineInfo);\n    }\n\n    /**\n     * Gets or create room\n     * @param appId \n     * @param getOrCreateRoomPara \n     * @returns or create room \n     */\n    public async getOrCreateRoom(appId: string, getOrCreateRoomPara: IGetOrCreateRoomPara): Promise<IResult<IGetOrCreateRoomRsp>> {\n        if (!this.terminalClient) return Result.buildErr('当前服务器断开！请稍后再试！', ErrorCodes.AuthUnverified);\n\n        let ret = await this.terminalClient.callApi('TerminalGetOrCreateRoom', { \n            ...getOrCreateRoomPara,\n            appId,\n         });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err?.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res);\n    }\n    \n    /**\n     * Filters rooms\n     * @param filter \n     * @param [skip] \n     * @param [limit] \n     * @returns rooms \n     */\n    public async filterRooms(\n        filter: IRoomsFilterPara,\n        skip?: number,\n        limit?: number\n    ): Promise<IResult<IRoomsFilterRes>> {\n        if (!this.terminalClient) return Result.buildErr('当前服务器断开！请稍后再试！', ErrorCodes.AuthUnverified);\n\n        let ret = await this.terminalClient.callApi('TerminalFilterRoom', { filter,skip,limit });\n        if (!ret.isSucc) {\n            return Result.buildErr(ret.err.message, (ret.err?.code ?? 1) as number);\n        }\n        return Result.buildSucc(ret.res);\n    }\n}"]}